(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.4' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     12248,        319]
NotebookOptionsPosition[     11319,        282]
NotebookOutlinePosition[     11697,        298]
CellTagsIndexPosition[     11654,        295]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Sandpile Model", "Title",
 CellChangeTimes->{{3.6695747307340837`*^9, 3.669574737850984*^9}}],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Initialization", "Subsection"]], "Subsubsection",
 CellChangeTimes->{{3.6700035946241255`*^9, 3.670003604199503*^9}, 
   3.670208651815277*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"gridsize", " ", "=", " ", "41"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sandRate", " ", "=", " ", "1"}], ";", " ", 
  RowBox[{"(*", 
   RowBox[{
   "How", " ", "many", " ", "steps", " ", "to", " ", "wait", " ", "before", 
    " ", "adding", " ", "more", " ", "sand"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"critHeight", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"addSand", "[", 
   RowBox[{"place_:", 
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"IntegerPart", "[", 
        RowBox[{"gridsize", "/", "2"}], "]"}], ",", " ", 
       RowBox[{"IntegerPart", "[", 
        RowBox[{"gridsize", "/", "2"}], "]"}]}], "}"}], "}"}]}], "]"}], " ", ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"i", ",", " ", "x", ",", " ", "y"}], "}"}], ",", " ", 
    RowBox[{"(*", 
     RowBox[{
     "add", " ", "sand", " ", "to", " ", "the", " ", "middle", " ", "of", " ",
       "the", " ", "pile"}], " ", "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", "=", "1"}], ",", " ", 
       RowBox[{"i", "\[LessEqual]", " ", 
        RowBox[{"Length", "[", "place", "]"}]}], ",", " ", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"x", "=", 
         RowBox[{"place", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"y", "=", 
         RowBox[{"place", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "2"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"grid", "[", 
          RowBox[{"[", 
           RowBox[{"x", ",", "y"}], "]"}], "]"}], " ", "+=", " ", "1"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]",
    "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.6700035674723597`*^9, 3.6700036542782106`*^9}, {
   3.670003729539316*^9, 3.6700037396323767`*^9}, {3.670207058776082*^9, 
   3.6702070654095435`*^9}, {3.6702073107343826`*^9, 3.670207316806773*^9}, {
   3.670208390367284*^9, 3.670208394278058*^9}, {3.6702089985026712`*^9, 
   3.670209004866353*^9}, {3.6702859740925617`*^9, 3.6702859886186266`*^9}, 
   3.670287023278055*^9, 3.6702871403086767`*^9, {3.6702877382812357`*^9, 
   3.670287740899297*^9}, {3.670288056467272*^9, 3.67028807183197*^9}, {
   3.670289408833767*^9, 3.670289413297996*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Reset Button", "Subsubsection",
 CellChangeTimes->{{3.670287147812068*^9, 3.670287153700289*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"grid", " ", "=", " ", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{"0", ",", " ", 
       RowBox[{"{", 
        RowBox[{"n", ",", " ", "gridsize"}], "}"}]}], "]"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"n", ",", " ", "gridsize"}], "}"}]}], "]"}]}], ";"}]], "Input"]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Active Code", "Subsection"]], "Subsubsection",
 CellChangeTimes->{{3.670208620829195*^9, 3.67020862601001*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"relaxation", " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", " ", "j"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", " ", "gridsize"}], ",", " ", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", " ", 
           RowBox[{"j", "\[LessEqual]", " ", "gridsize"}], ",", " ", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"grid", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}], " ", 
               "\[GreaterEqual]", " ", "critHeight"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"grid", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "j"}], "]"}], "]"}], " ", "-=", " ", 
                "4"}], ";", " ", 
               RowBox[{"(*", 
                RowBox[{"Lose", " ", "4", " ", "sand"}], "*)"}], 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                 "give", " ", "sand", " ", "to", " ", "the", " ", 
                  "neighbors"}], " ", "|", " ", 
                 RowBox[{"Open", " ", "Boundry", " ", "Conditions"}]}], " ", 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"i", "\[NotEqual]", " ", "gridsize"}], ",", " ", 
                 RowBox[{
                  RowBox[{"grid", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "+", "1"}], ",", " ", "j"}], "]"}], "]"}], 
                  "++"}]}], "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"j", "\[NotEqual]", " ", "gridsize"}], ",", " ", 
                 RowBox[{
                  RowBox[{"grid", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", " ", 
                    RowBox[{"j", "+", "1"}]}], "]"}], "]"}], "++"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"i", "\[NotEqual]", " ", "1"}], ",", " ", 
                 RowBox[{
                  RowBox[{"grid", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "-", "1"}], ",", " ", "j"}], "]"}], "]"}], 
                  "++"}]}], "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"j", "\[NotEqual]", " ", "1"}], ",", " ", 
                 RowBox[{
                  RowBox[{"grid", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", " ", 
                    RowBox[{"j", "-", "1"}]}], "]"}], "]"}], "++"}]}], "]"}], 
               ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "]"}], ";"}]}], " ", 
    RowBox[{"(*", 
     RowBox[{"end", " ", "of", " ", "double", " ", "for", " ", "loop"}], " ", 
     "*)"}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.6700037568453274`*^9, 3.6700038025405893`*^9}, {
   3.670207087052264*^9, 3.670207185241086*^9}, {3.670207285583616*^9, 
   3.6702072912786894`*^9}, {3.6702073892354393`*^9, 
   3.6702074285724063`*^9}, {3.6702075587363853`*^9, 
   3.6702075592132487`*^9}, {3.670208109704667*^9, 3.6702083539628615`*^9}, {
   3.6702084046518307`*^9, 3.670208438302224*^9}, 3.670208555116831*^9, {
   3.6702087055054283`*^9, 3.670208724159105*^9}, {3.6702090700269356`*^9, 
   3.670209151622178*^9}, {3.6702091988849597`*^9, 3.670209332481083*^9}, {
   3.6702093797615967`*^9, 3.670209392612152*^9}, {3.670214225425387*^9, 
   3.6702142269904795`*^9}, 3.6702859504602094`*^9, {3.670286304576234*^9, 
   3.6702863051924686`*^9}, {3.6702880741333466`*^9, 3.6702880757669983`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"pourSand", "[", "totalSand_", "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"numSand", ",", " ", "cycles"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"numSand", "=", "1"}], ",", " ", 
       RowBox[{"numSand", " ", "\[LessEqual]", " ", "totalSand"}], ",", " ", 
       RowBox[{"numSand", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"addSand", "[", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"cycles", "=", "1"}], ",", " ", 
          RowBox[{"cycles", " ", "\[LessEqual]", "  ", "sandRate"}], ",", " ", 
          RowBox[{"cycles", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{"relaxation", ";"}]}], "\[IndentingNewLine]", "]"}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]",
    "]"}]}]], "Input",
 CellChangeTimes->{{3.6702861272240305`*^9, 3.670286131658803*^9}, {
  3.6702862922282906`*^9, 3.6702862924211874`*^9}, {3.6702867480730295`*^9, 
  3.6702867481354823`*^9}, {3.670286903490368*^9, 3.6702869075234847`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Run and Plot the Simulation", "Subsubsection",
 CellChangeTimes->{{3.67028830224984*^9, 3.6702883061856146`*^9}}],

Cell[BoxData[
 RowBox[{"pourSand", "[", "4000", "]"}]], "Input",
 CellChangeTimes->{{3.6702859322849283`*^9, 3.6702859614343853`*^9}, {
   3.6702860221837025`*^9, 3.6702860236159105`*^9}, 3.670286138131914*^9, 
   3.670286809097667*^9, {3.6702868412977843`*^9, 3.6702868423997726`*^9}, 
   3.6702871056671853`*^9, 3.670287202177389*^9, 3.670289436784025*^9, {
   3.6702895420402536`*^9, 3.670289555098251*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dynamic", "[", 
  RowBox[{"ArrayPlot", "[", "grid", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.6702869552154093`*^9, 3.6702869604373145`*^9}, {
   3.6702870040789757`*^9, 3.6702870116285143`*^9}, {3.67028717519384*^9, 
   3.6702871763940783`*^9}, {3.6702872638648043`*^9, 3.6702872671292067`*^9}, 
   3.670287311325121*^9, {3.6702885120817785`*^9, 3.6702885317573233`*^9}, {
   3.6702893925070853`*^9, 3.670289394048932*^9}, {3.6702895082756205`*^9, 
   3.6702895115984626`*^9}}],

Cell[BoxData[
 DynamicBox[ToBoxes[
   ArrayPlot[$CellContext`grid], StandardForm],
  ImageSizeCache->{414., {204., 209.}}]], "Output",
 CellChangeTimes->{{3.670286962639374*^9, 3.670286973364368*^9}, {
   3.6702870086453114`*^9, 3.6702870201211863`*^9}, 3.67028705946395*^9, 
   3.6702871177784605`*^9, 3.670287177078822*^9, 3.67028727199193*^9, {
   3.6702873040233917`*^9, 3.6702873119885807`*^9}, {3.670288492717962*^9, 
   3.67028853243419*^9}, 3.6702893946080303`*^9, 3.670289430626382*^9, {
   3.670289518012782*^9, 3.670289523355397*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1366, 685},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
Magnification:>1.15 Inherited,
FrontEndVersion->"10.4 for Microsoft Windows (64-bit) (February 25, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 99, 1, 117, "Title"],
Cell[CellGroupData[{
Cell[704, 27, 167, 2, 46, "Subsubsection"],
Cell[874, 31, 2524, 60, 255, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[3435, 96, 103, 1, 44, "Subsubsection"],
Cell[3541, 99, 344, 10, 34, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[3922, 114, 135, 1, 46, "Subsubsection"],
Cell[4060, 117, 4370, 95, 365, "Input"],
Cell[8433, 214, 1198, 26, 189, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[9668, 245, 119, 1, 44, "Subsubsection"],
Cell[9790, 248, 410, 6, 67, "Input"],
Cell[CellGroupData[{
Cell[10225, 258, 506, 8, 34, "Input"],
Cell[10734, 268, 545, 9, 430, "Output"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

